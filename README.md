# SimpleChat

## Опис на апликацијата
SimpleChat е чет апликација имплементирана со TCP sockets во Windows Forms (C#). SimpleChat овозможува  на корисникот да си создаде своја соба, каде што други корисници ќе можат да влегуваат и да си разменуваат пораки. Апликацијата сслужи и како сервер и како клиент т.е. секој корисник може да влезе во други соби, но може и да создаде своја соба.

Функционалности:
  - Корисникот може да создаде соба
  - Корисникот може да влезе во соба
  - Корисникот може да излезе од соба
  - Корисникот може да пишува порака во соба
  - Корисникот може да си го промени името
  - Ако веќе постои името на корисникот во собата на која сака да се приклучи, информација за да си го смени името
  - Ако корисникот е сопственик на собата може да извади некој од собата (kick) и да спречи некој да влегува (ban)
  
Сите овие функционалности се синхронизираат помеѓу поврзаните корисници.

## 2. Опис на решението
### 2.1 Класи
```
    public class User
    {
        public String nickname { get; set; }
        public Socket socket { get; set; }
    }
```
Класата User се користи за репрезентација на еден корисник на апликацијата. За секој корисник се чува конекцијата (socket) и неговото име.

``` 
    public class Message
    {

        public User user { get; set; }
        public String text { get; set; }
    }
```
Класата Message се користи за репрезентација на еден порака. За секоја порака се чува кој е тесктот и од кој корисник е пораката.

``` 
    public class Room
    {

        public String name { get; set; }
        public List<User> users { get; set; }
        public List<Message> messages { get; set; }
        public User owner { get; set; }
        public List<User> banned { get; set; }
        public String topic { get; set; }
    }
```
Класата Room се користи за репрезентација на една соба. За секоја соба се чува името на собата, насловот на собата, листа од корисници кои се во собата, листа на банирани користици, листа од пораки и сопственикот.

```
    public enum PacketType
    {
        Message,
        Join,
        Joined,
        Part,
        Parted,
        Kick,
        Kicked,
        Ban,
        Banned,
        ChangeNick,
        ChangedNick,
        RequestNickChange,
        Null
    }
```
Енумерацијата PacketType се користи за означување на еден пакет кој треба да се испрати и за идентификување на пакет кој сме го добиле.

```
 public class Packet
    {
        public PacketType packetType { get; set; }
        public User user { get; set; }
        public Message message { get; set; }
        public Room room { get; set; }
        public List<String> users { get; set; }
        public String newNickname { get; set; }
    }
```
Класата Packet служи за енкапсулирање на информациите кои треба да се испратат преку socket. Еден пакет кој треба да се испрати се означува со различен тип (пр. Join, Parted, NickChange) и според типот се пополнуваат другите потребни атрибути. Еден пакет кој го добиваме преку socket се парсира според типот и потоа се парсираат различните атрибути кои се пратени преку него.

## 3. Опис на Packet класата
Пакетите кои се испраќаат преку TCP Socket се структурираат во Packet класата. 

Пример за еден пакет од тип Message:

| Тип на Пакет  | Должина на името на собата | Должина на името на корисникот | Должина на пораката | Име на соба | Име на корисник |  Порака |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 0  | 5  | 7 | 7 | finki | Ljupcho | Zdravo. |

Репрезентација како стринг:
0;5;7;7;finkiLjupchoZdravo.

Меѓу секоја должина на некој атрибут се додава знакот ';' кој се користи за разликување на различните делови.

Овој пакет кога треба да се испрати, прво се инстанцира еден објект од класа Packet, се поставува типот на пакетот преку PacketType енумерацијата и се поставуваат потребните атрибути. Бидејќи преку TCP socket се испраќаат бајти, мора пакетот да го претвориме во бајти со методата GetDataStream која враќа низа од бајти. Оваа низа од бајти се испраќа преку TCP Socket. За градење на низата од бајти се користи Encoding.ASCII.GetBytes() методата која ни дава низа од бајти за еден стринг.

Ако добиеме нов пакет, за да го претвориме во објект од класата Packet го користиме конструктурот од класата Packet кој како аргумент прима низа од бајти.

## 4. Слики од апликацијата


## 5. Упатство за тестирање

Се стартува апликацијата два пати. Во првата апликација се креира соба, а во втората апликација се влегува во собата креирана од првата апликација. Се користи IP адреса 127.0.0.1 и порта која што ја пишува на статус линијата на првата апликација. Овде може да се тестира пишувањето од двете апликации, напуштање на собата од втората апликација, банирање и кикнување на корисник.
